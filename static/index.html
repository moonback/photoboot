<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Studio Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>

<body class="kiosk-bg text-white overflow-hidden relative">
    <!-- Grille de fond anim√©e -->
    <div class="grid-pattern"></div>

    <!-- Particules flottantes -->
    <div id="particles-container"></div>

    <!-- D√©corations flottantes -->
    <div class="floating-element top-1/4 left-8 opacity-20 float-1">
        <div class="text-6xl">‚ú®</div>
    </div>
    <div class="floating-element top-1/3 right-16 opacity-20 float-2">
        <div class="text-5xl">üì∏</div>
    </div>
    <div class="floating-element bottom-1/3 left-1/4 opacity-15 float-3">
        <div class="text-6xl">‚≠ê</div>
    </div>

    <!-- Interface principale -->
    <div id="main-interface" class="h-screen flex flex-col items-center justify-center relative z-10">
        <!-- Logo et titre -->
        <div class="text-center mb-16 kiosk-fade-in">
            <div class="mb-6">
                <span class="text-7xl kiosk-logo">üì∑</span>
            </div>
            <h1 class="title-font text-6xl font-black kiosk-title mb-6">
                Photo Studio Pro
            </h1>
            <p class="text-xl text-slate-300 font-light tracking-wide mb-6">
                Capturez vos moments les plus pr√©cieux
            </p>
            <div
                class="w-32 h-2 bg-gradient-to-r from-blue-500 via-purple-600 to-pink-500 mx-auto rounded-full shadow-lg">
            </div>
        </div>

        <!-- Bouton principal avec effet sonore -->
        <div class="mb-12 kiosk-fade-in-delay">
            <button id="start-button" class="kiosk-btn group relative">
                <span class="relative z-10 flex items-center gap-4">
                    <span class="text-2xl animate-pulse">üöÄ</span>
                    <span>COMMENCER</span>
                </span>
            </button>
        </div>

        <!-- Informations syst√®me avec statuts -->
        <div
            class="text-center kiosk-fade-in-delay-2 kiosk-glass rounded-2xl p-8 backdrop-blur-lg bg-gradient-to-br from-slate-800/60 to-slate-900/60 border-2 border-slate-700/30 shadow-2xl mb-10">
            <div class="flex flex-col items-center gap-4">
                <p id="company-name"
                    class="text-2xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                    Photo Studio Pro
                </p>
                <div class="w-24 h-1 bg-gradient-to-r from-blue-500/30 via-purple-500/30 to-pink-500/30 rounded-full">
                </div>
                <p id="event-type" class="text-lg text-slate-400 font-light tracking-wide">Vos moments pr√©cieux</p>
            </div>
        </div>

        <!-- Statuts syst√®me -->
        <div class="flex gap-6 mb-10 kiosk-fade-in-delay-3">
            <div id="camera-status" class="kiosk-status active">
                <div class="status-text">üìπ Cam√©ra Active</div>
            </div>
            <div id="printer-status" class="kiosk-status active">
                <div class="status-text">üñ®Ô∏è Imprimante Pr√™te</div>
            </div>
        </div>

        <!-- Bouton admin styl√© -->
        <div class="fixed bottom-8 left-8 kiosk-fade-in">
            <button id="admin-button" class="kiosk-admin-btn">
                <span class="flex items-center gap-3">
                    <span class="text-xl">‚öôÔ∏è</span>
                    <span>Administration</span>
                </span>
            </button>
        </div>

        <!-- Compteur de photos premium -->
        <div class="fixed bottom-8 right-8 kiosk-counter kiosk-fade-in">
            <div class="text-center">
                <div class="text-5xl font-bold text-transparent bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text mb-3"
                    id="photo-count">0</div>
                <div class="text-lg text-slate-400 uppercase tracking-wider mb-4">Photos captur√©es</div>
                <div class="w-full h-3 bg-slate-700 rounded-full shadow-inner overflow-hidden">
                    <div class="h-full progress-bar transition-all duration-1000 ease-out" style="width: 0%"
                        id="photo-progress"></div>
                </div>
                <div class="text-xs text-slate-500 mt-2">Objectif: 100 photos</div>
            </div>
        </div>
    </div>

    <!-- Interface de capture am√©lior√©e -->
    <div id="capture-interface" class="h-screen hidden flex flex-col items-center justify-center kiosk-capture">
        <div class="text-center mb-10">
            <h2
                class="text-5xl font-bold bg-gradient-to-r from-green-400 to-blue-400 bg-clip-text text-transparent mb-6">
                Pr√©parez-vous !
            </h2>
            <p class="text-2xl text-slate-300">La photo sera prise dans</p>
        </div>

        <!-- Aper√ßu cam√©ra avec cadre styl√© -->
        <div class="mb-10 relative">
            <div
                class="absolute -inset-3 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 rounded-2xl blur-lg opacity-50">
            </div>
            <video id="camera-video" autoplay muted
                class="relative rounded-2xl shadow-2xl border-3 border-white/20 backdrop-blur-sm"></video>
            <canvas id="capture-canvas" class="hidden"></canvas>

            <!-- Compteur d√©gressif avec effet dramatique -->
            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                <span id="countdown-number" class="kiosk-countdown">3</span>
            </div>

            <!-- Indicateurs de coins pour le cadrage -->
            <div class="absolute top-3 left-3 w-8 h-8 border-l-3 border-t-3 border-white opacity-60"></div>
            <div class="absolute top-3 right-3 w-8 h-8 border-r-3 border-t-3 border-white opacity-60"></div>
            <div class="absolute bottom-3 left-3 w-8 h-8 border-l-3 border-b-3 border-white opacity-60"></div>
            <div class="absolute bottom-3 right-3 w-8 h-8 border-r-3 border-b-3 border-white opacity-60"></div>
        </div>

        <!-- Boutons de contr√¥le -->
        <div class="flex space-x-6">
            <button id="cancel-capture" class="kiosk-action-btn">
                <span class="flex items-center gap-3">
                    <span class="text-2xl">‚ùå</span>
                    <span>Annuler</span>
                </span>
            </button>
            <button id="retake-photo" class="kiosk-action-btn info hidden">
                <span class="flex items-center gap-3">
                    <span class="text-2xl">üîÑ</span>
                    <span>Reprendre</span>
                </span>
            </button>
        </div>
    </div>

    <!-- Interface de r√©sultat premium -->
    <div id="result-interface" class="h-screen hidden flex flex-col items-center justify-center kiosk-result">
        <div class="text-center mb-12">
            <h2
                class="text-6xl font-bold bg-gradient-to-r from-green-400 via-emerald-400 to-teal-400 bg-clip-text text-transparent mb-6">
                Photo prise !
            </h2>
            <p class="text-3xl text-slate-300 italic">Votre chef-d'≈ìuvre est pr√™t</p>
        </div>

        <!-- Aper√ßu de la photo avec effets -->
        <div class="mb-12 relative">
            <div
                class="absolute -inset-4 bg-gradient-to-r from-green-400 via-emerald-400 to-teal-400 rounded-2xl blur-lg opacity-40">
            </div>
            <img id="result-image"
                class="relative max-w-4xl object-cover rounded-2xl shadow-2xl transform hover:scale-105 transition-transform duration-700 border-3 border-green-400/30"
                alt="Photo prise">
        </div>

        <!-- Boutons d'action -->
        <div class="flex flex-wrap justify-center gap-8">
            <button id="new-photo" class="kiosk-action-btn primary">
                <span class="flex items-center gap-3">
                    <span class="text-2xl">üì∏</span>
                    <span>Nouvelle photo</span>
                </span>
            </button>
            <button id="download-photo" class="kiosk-action-btn success">
                <span class="flex items-center gap-3">
                    <span class="text-3xl">üíæ</span>
                    <span>T√©l√©charger</span>
                </span>
            </button>
            <button id="print-photo" class="kiosk-action-btn warning">
                <span class="flex items-center gap-3">
                    <span class="text-2xl">üñ®Ô∏è</span>
                    <span>Imprimer</span>
                </span>
            </button>
            <button id="email-photo" class="kiosk-action-btn info">
                <span class="flex items-center gap-3">
                    <span class="text-2xl">üìß</span>
                    <span>Envoyer par email</span>
                </span>
            </button>
        </div>
    </div>

    <!-- Modal d'administration -->
    <div id="admin-modal" class="kiosk-modal hidden">
        <div class="kiosk-modal-content">
            <div class="flex justify-between items-center mb-5">
                <h3 class="text-xl font-bold text-white">Administration</h3>
                <button id="close-admin"
                    class="text-2xl text-white hover:text-gray-300 transition-colors">&times;</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-white mb-2 text-sm">Nom d'utilisateur</label>
                    <input type="text" id="admin-username" class="kiosk-input w-full" placeholder="admin">
                </div>
                <div>
                    <label class="block text-white mb-2 text-sm">Mot de passe</label>
                    <input type="password" id="admin-password" class="kiosk-input w-full" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button id="admin-login" class="kiosk-action-btn primary w-full">Se connecter</button>
                <div id="admin-status" class="hidden text-center p-3 rounded-lg"></div>
            </div>
        </div>
    </div>

    <!-- Modal d'impression -->
    <div id="print-modal" class="kiosk-modal hidden">
        <div class="kiosk-modal-content">
            <div class="flex justify-between items-center mb-5">
                <h3 class="text-xl font-bold text-white">Impression</h3>
                <button id="close-print"
                    class="text-2xl text-white hover:text-gray-300 transition-colors">&times;</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-white mb-2 text-sm">Imprimante</label>
                    <select id="printer-select" class="kiosk-input w-full">
                        <option value="">Imprimante par d√©faut</option>
                    </select>
                </div>
                <div>
                    <label class="block text-white mb-2 text-sm">Nombre de copies</label>
                    <input type="number" id="print-copies" class="kiosk-input w-full" value="1" min="1" max="10">
                </div>
                <div>
                    <label class="block text-white mb-2 text-sm">Format papier</label>
                    <select id="paper-size" class="kiosk-input w-full">
                        <option value="4x6">4x6 pouces</option>
                        <option value="5x7">5x7 pouces</option>
                        <option value="6x8">6x8 pouces</option>
                        <option value="A4">A4</option>
                        <option value="letter">Letter</option>
                    </select>
                </div>
                <button id="start-print" class="kiosk-action-btn primary w-full">Imprimer</button>
                <div id="print-status" class="hidden text-center p-3 rounded-lg"></div>
            </div>
        </div>
    </div>

    <!-- Modal d'email -->
    <div id="email-modal" class="kiosk-modal hidden">
        <div class="kiosk-modal-content">
            <div class="flex justify-between items-center mb-5">
                <h3 class="text-xl font-bold text-white">Envoi par email</h3>
                <button id="close-email"
                    class="text-2xl text-white hover:text-gray-300 transition-colors">&times;</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-white mb-2 text-sm">Votre nom (optionnel)</label>
                    <input type="text" id="user-name" class="kiosk-input w-full" placeholder="Votre nom">
                </div>
                <div>
                    <label class="block text-white mb-2 text-sm">Adresse email</label>
                    <input type="email" id="user-email" class="kiosk-input w-full" placeholder="votre@email.com"
                        required>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="gdpr-consent" class="mr-3 scale-110">
                    <label for="gdpr-consent" class="text-white text-sm">
                        J'accepte que mes donn√©es soient utilis√©es pour l'envoi de cette photo
                    </label>
                </div>
                <button id="send-email" class="kiosk-action-btn primary w-full">Envoyer</button>
                <div id="email-status" class="hidden text-center p-3 rounded-lg"></div>
            </div>
        </div>
    </div>

    <!-- Overlay de chargement -->
    <div id="loading-overlay"
        class="fixed inset-0 bg-black/80 backdrop-blur-lg z-50 hidden items-center justify-center">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-3"></div>
            <p id="loading-text" class="text-white text-lg">Chargement...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/static/js/config.js"></script>
    <script src="/static/js/custom-config.js"></script>

    <!-- Modules JavaScript refactoris√©s -->
    <script src="/static/js/modules/FrameManager.js"></script>
    <script src="/static/js/modules/CameraManager.js"></script>
    <script src="/static/js/modules/PhotoManager.js"></script>
    <script src="/static/js/modules/CountdownManager.js"></script>
    <script src="/static/js/modules/InterfaceManager.js"></script>

    <!-- Application principale -->
    <script src="/static/js/app.js"></script>
    <script src="/static/js/print-email.js"></script>

    <script>
        // Configuration de l'application
        const PhotoboothConfig = {
            companyName: 'Photo Studio Pro',
            eventType: 'Vos moments pr√©cieux',
            countdownDuration: 3,
            photoQuality: 0.9,
            customLogo: null,
            maxPhotos: 100,
            stats: {
                photos: 0,
                downloads: 0,
                prints: 0,
                emails: 0
            },
            sounds: {
                countdown: true,
                capture: true,
                success: true
            }
        };

        // Gestionnaire principal de l'application
        class PhotoboothApp {
            constructor() {
                this.currentPhoto = null;
                this.cameraStream = null;
                this.isCapturing = false;
                this.particlesInterval = null;
                this.init();
            }

            init() {
                console.log('üöÄ Initialisation de Photo Studio Pro...');
                this.setupEventListeners();
                this.loadConfiguration();
                this.createParticles();
                this.updateStats();
            }

            setupEventListeners() {
                // Bouton principal
                document.getElementById('start-button').addEventListener('click', () => {
                    this.startCapture();
                });

                // Boutons de contr√¥le
                document.getElementById('cancel-capture').addEventListener('click', () => {
                    this.cancelCapture();
                });

                document.getElementById('retake-photo').addEventListener('click', () => {
                    this.retakePhoto();
                });

                // Boutons d'action
                document.getElementById('new-photo').addEventListener('click', () => {
                    this.newPhoto();
                });

                document.getElementById('download-photo').addEventListener('click', () => {
                    this.downloadPhoto();
                });

                document.getElementById('print-photo').addEventListener('click', () => {
                    this.showPrintModal();
                });

                document.getElementById('email-photo').addEventListener('click', () => {
                    this.showEmailModal();
                });

                // Administration
                document.getElementById('admin-button').addEventListener('click', () => {
                    this.showAdminModal();
                });

                // Modals
                this.setupModalHandlers();
            }

            setupModalHandlers() {
                // Administration
                document.getElementById('close-admin').addEventListener('click', () => {
                    document.getElementById('admin-modal').classList.add('hidden');
                });

                document.getElementById('admin-login').addEventListener('click', () => {
                    this.handleAdminLogin();
                });

                // Impression
                document.getElementById('close-print').addEventListener('click', () => {
                    document.getElementById('print-modal').classList.add('hidden');
                });

                document.getElementById('start-print').addEventListener('click', () => {
                    this.handlePrint();
                });

                // Email
                document.getElementById('close-email').addEventListener('click', () => {
                    document.getElementById('email-modal').classList.add('hidden');
                });

                document.getElementById('send-email').addEventListener('click', () => {
                    this.handleEmailSend();
                });
            }

            async startCapture() {
                if (this.isCapturing) return;

                try {
                    this.showLoading('Initialisation de la cam√©ra...');
                    await this.initCamera();
                    this.hideLoading();
                    this.showCaptureInterface();
                    this.startCountdown();
                } catch (error) {
                    this.hideLoading();
                    this.showError('Impossible d\'acc√©der √† la cam√©ra');
                }
            }

            async initCamera() {
                const constraints = {
                    video: {
                        width: { ideal: 1920 },
                        height: { ideal: 1080 },
                        facingMode: 'user'
                    }
                };

                this.cameraStream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.getElementById('camera-video');
                video.srcObject = this.cameraStream;

                return new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        video.play();
                        resolve();
                    };
                });
            }

            showCaptureInterface() {
                const mainInterface = document.getElementById('main-interface');
                const captureInterface = document.getElementById('capture-interface');

                if (mainInterface && captureInterface) {
                    mainInterface.classList.add('hidden');
                    captureInterface.classList.remove('hidden');
                }
            }

            startCountdown() {
                let count = PhotoboothConfig.countdownDuration;
                const countdownElement = document.getElementById('countdown-number');
                this.isCapturing = true;

                const interval = setInterval(() => {
                    if (count > 0) {
                        countdownElement.textContent = count;
                        // Son du compte √† rebours
                        if (PhotoboothConfig.sounds.countdown) {
                            this.playSound('beep');
                        }
                    } else {
                        clearInterval(interval);
                        countdownElement.textContent = 'üì∏';
                        this.capturePhoto();
                    }
                }, 1000);
            }

            capturePhoto() {
                const video = document.getElementById('camera-video');
                const canvas = document.getElementById('capture-canvas');
                const ctx = canvas.getContext('2d');

                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;

                ctx.drawImage(video, 0, 0);

                // Appliquer des effets si n√©cessaire
                this.applyPhotoEffects(ctx, canvas);

                this.currentPhoto = canvas.toDataURL('image/jpeg', PhotoboothConfig.photoQuality);

                // Son de capture
                if (PhotoboothConfig.sounds.capture) {
                    this.playSound('shutter');
                }

                // Flash effect
                this.showFlashEffect();

                // Arr√™ter la cam√©ra
                this.stopCamera();

                // Afficher le r√©sultat
                setTimeout(() => {
                    this.showResult();
                }, 1000);

                // Mettre √† jour les statistiques
                PhotoboothConfig.stats.photos++;
                this.updateStats();
                this.updatePhotoCounter();

                this.showSuccess('Photo captur√©e avec succ√®s !');
            }

            // M√©thode pour appliquer des effets aux photos
            applyPhotoEffects(ctx, canvas) {
                // Effet de contraste l√©ger
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;

                for (let i = 0; i < data.length; i += 4) {
                    // Am√©liorer le contraste
                    data[i] = Math.min(255, Math.max(0, (data[i] - 128) * 1.1 + 128));     // Rouge
                    data[i + 1] = Math.min(255, Math.max(0, (data[i + 1] - 128) * 1.1 + 128)); // Vert
                    data[i + 2] = Math.min(255, Math.max(0, (data[i + 2] - 128) * 1.1 + 128)); // Bleu
                }

                ctx.putImageData(imageData, 0, 0);
            }

            // M√©thode pour jouer des sons
            playSound(type) {
                // Simulation de sons (√† remplacer par de vrais fichiers audio)
                console.log(`üîä Son jou√©: ${type}`);
            }

            // M√©thode pour afficher l'effet de flash
            showFlashEffect() {
                const flash = document.createElement('div');
                flash.className = 'fixed inset-0 bg-white opacity-80 z-50 pointer-events-none';
                flash.style.animation = 'flashEffect 0.3s ease-out';
                document.body.appendChild(flash);

                setTimeout(() => {
                    document.body.removeChild(flash);
                }, 300);
            }

            // M√©thode pour arr√™ter la cam√©ra
            stopCamera() {
                if (this.cameraStream) {
                    this.cameraStream.getTracks().forEach(track => track.stop());
                    this.cameraStream = null;
                }
            }

            // M√©thode pour afficher le r√©sultat
            showResult() {
                const mainInterface = document.getElementById('main-interface');
                const captureInterface = document.getElementById('capture-interface');
                const resultInterface = document.getElementById('result-interface');

                if (mainInterface && captureInterface && resultInterface) {
                    mainInterface.classList.add('hidden');
                    captureInterface.classList.add('hidden');
                    resultInterface.classList.remove('hidden');

                    // Afficher la photo captur√©e
                    const resultImage = document.getElementById('result-image');
                    if (resultImage && this.currentPhoto) {
                        resultImage.src = this.currentPhoto;
                    }
                }
            }

            // M√©thode pour afficher le modal d'administration
            showAdminModal() {
                const adminModal = document.getElementById('admin-modal');
                if (adminModal) {
                    adminModal.classList.remove('hidden');
                }
            }

            // M√©thode pour g√©rer la connexion admin
            handleAdminLogin() {
                const username = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;
                const adminStatus = document.getElementById('admin-status');

                if (username && password) {
                    adminStatus.textContent = 'Connexion en cours...';
                    adminStatus.className = 'bg-blue-500 text-white';
                    adminStatus.classList.remove('hidden');

                    // Simulation de connexion
                    setTimeout(() => {
                        if (username === 'admin' && password === 'admin') {
                            adminStatus.textContent = 'Connexion r√©ussie !';
                            adminStatus.className = 'bg-green-500 text-white';
                        } else {
                            adminStatus.textContent = 'Identifiants incorrects';
                            adminStatus.className = 'bg-red-500 text-white';
                        }
                    }, 1000);
                } else {
                    adminStatus.textContent = 'Veuillez remplir tous les champs';
                    adminStatus.className = 'bg-red-500 text-white';
                    adminStatus.classList.remove('hidden');
                }
            }

            showPrintModal() {
                if (!this.currentPhoto) return;
                document.getElementById('print-modal').classList.remove('hidden');
            }

            handlePrint() {
                const copies = document.getElementById('print-copies').value;
                const paperSize = document.getElementById('paper-size').value;

                this.showLoading('Envoi √† l\'imprimante...');

                // Simulation d'impression
                setTimeout(() => {
                    this.hideLoading();
                    document.getElementById('print-modal').classList.add('hidden');

                    PhotoboothConfig.stats.prints += parseInt(copies);
                    this.updateStats();

                    this.showSuccess(`${copies} copie(s) envoy√©e(s) √† l'imprimante !`);
                }, 2000);
            }

            showEmailModal() {
                if (!this.currentPhoto) return;
                document.getElementById('email-modal').classList.remove('hidden');
            }

            handleEmailSend() {
                const userEmail = document.getElementById('user-email').value;
                const userName = document.getElementById('user-name').value;

                if (!userEmail) {
                    this.showError('Veuillez saisir une adresse email');
                    return;
                }

                this.showLoading('Envoi de l\'email...');

                // Simulation d'envoi d'email
                setTimeout(() => {
                    this.hideLoading();
                    document.getElementById('email-modal').classList.add('hidden');

                    PhotoboothConfig.stats.emails++;
                    this.updateStats();

                    this.showSuccess('Email envoy√© avec succ√®s !');
                }, 2000);
            }

            loadConfiguration() {
                // Charger depuis le stockage local si disponible
                try {
                    const saved = JSON.parse(localStorage.getItem('photobooth-config') || '{}');
                    if (saved.companyName) PhotoboothConfig.companyName = saved.companyName;
                    if (saved.eventType) PhotoboothConfig.eventType = saved.eventType;
                    if (saved.countdownDuration) PhotoboothConfig.countdownDuration = saved.countdownDuration;
                    if (saved.photoQuality) PhotoboothConfig.photoQuality = saved.photoQuality;
                    if (saved.customLogo) PhotoboothConfig.customLogo = saved.customLogo;
                    if (saved.stats) PhotoboothConfig.stats = saved.stats;

                    // Mettre √† jour l'interface
                    document.getElementById('company-name').textContent = PhotoboothConfig.companyName;
                    document.getElementById('event-type').textContent = PhotoboothConfig.eventType;
                } catch (error) {
                    console.warn('Impossible de charger la configuration sauvegard√©e');
                }
            }

            updateStats() {
                // Sauvegarder les stats
                try {
                    const config = {
                        companyName: PhotoboothConfig.companyName,
                        eventType: PhotoboothConfig.eventType,
                        countdownDuration: PhotoboothConfig.countdownDuration,
                        photoQuality: PhotoboothConfig.photoQuality,
                        customLogo: PhotoboothConfig.customLogo,
                        stats: PhotoboothConfig.stats
                    };
                    localStorage.setItem('photobooth-config', JSON.stringify(config));
                } catch (error) {
                    console.warn('Impossible de sauvegarder les statistiques');
                }
            }

            updatePhotoCounter() {
                const photoCount = PhotoboothConfig.stats.photos;
                const maxPhotos = PhotoboothConfig.maxPhotos;

                document.getElementById('photo-count').textContent = photoCount;

                const progress = Math.min((photoCount / maxPhotos) * 100, 100);
                document.getElementById('photo-progress').style.width = progress + '%';

                // Changer la couleur de la barre de progression
                const progressBar = document.getElementById('photo-progress');
                if (progress >= 100) {
                    progressBar.style.background = 'linear-gradient(90deg, #10b981, #059669)';
                } else if (progress >= 75) {
                    progressBar.style.background = 'linear-gradient(90deg, #f59e0b, #d97706)';
                }
            }

            createParticles() {
                const container = document.getElementById('particles-container');

                // Cr√©er des particules flottantes
                this.particlesInterval = setInterval(() => {
                    if (Math.random() < 0.3) { // 30% de chance de cr√©er une particule
                        const particle = document.createElement('div');
                        particle.className = 'particle';
                        particle.style.left = Math.random() * window.innerWidth + 'px';
                        particle.style.animationDelay = Math.random() * 2 + 's';

                        // Couleurs al√©atoires
                        const colors = ['#3b82f6', '#8b5cf6', '#ec4899', '#10b981', '#f59e0b'];
                        particle.style.background = colors[Math.floor(Math.random() * colors.length)];

                        container.appendChild(particle);

                        // Supprimer la particule apr√®s l'animation
                        setTimeout(() => {
                            if (particle.parentNode) {
                                container.removeChild(particle);
                            }
                        }, 6000);
                    }
                }, 1000);
            }

            showLoading(text = 'Chargement...') {
                const overlay = document.getElementById('loading-overlay');
                const textElement = document.getElementById('loading-text');
                textElement.textContent = text;
                overlay.classList.remove('hidden');
                overlay.classList.add('flex');
            }

            hideLoading() {
                const overlay = document.getElementById('loading-overlay');
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');
            }

            showSuccess(message) {
                this.showNotification(message, 'success');
            }

            showError(message) {
                this.showNotification(message, 'error');
            }

            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-8 right-8 p-6 rounded-2xl shadow-2xl z-50 transform translate-x-full transition-transform duration-500 backdrop-blur-lg border-2`;

                switch (type) {
                    case 'success':
                        notification.classList.add('bg-green-500/20', 'border-green-400', 'text-green-400');
                        notification.innerHTML = `<div class="flex items-center gap-3"><span class="text-xl">‚úÖ</span><span>${message}</span></div>`;
                        break;
                    case 'error':
                        notification.classList.add('bg-red-500/20', 'border-red-400', 'text-red-400');
                        notification.innerHTML = `<div class="flex items-center gap-3"><span class="text-xl">‚ùå</span><span>${message}</span></div>`;
                        break;
                    default:
                        notification.classList.add('bg-blue-500/20', 'border-blue-400', 'text-blue-400');
                        notification.innerHTML = `<div class="flex items-center gap-3"><span class="text-xl">‚ÑπÔ∏è</span><span>${message}</span></div>`;
                }

                document.body.appendChild(notification);

                // Animer l'entr√©e
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);

                // Supprimer apr√®s 4 secondes
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            document.body.removeChild(notification);
                        }
                    }, 500);
                }, 4000);
            }

            // Mise √† jour p√©riodique des statuts
            updateSystemStatus() {
                // Simuler l'√©tat de la cam√©ra
                const cameraStatus = document.getElementById('camera-status');
                const printerStatus = document.getElementById('printer-status');

                // Logique pour v√©rifier les √©tats r√©els des p√©riph√©riques
                // Pour la d√©mo, on simule des √©tats al√©atoires
                if (Math.random() > 0.9) {
                    cameraStatus.className = 'kiosk-status inactive';
                    cameraStatus.querySelector('.status-text').textContent = 'üìπ Cam√©ra D√©connect√©e';
                } else {
                    cameraStatus.className = 'kiosk-status active';
                    cameraStatus.querySelector('.status-text').textContent = 'üìπ Cam√©ra Active';
                }

                if (Math.random() > 0.95) {
                    printerStatus.className = 'kiosk-status inactive';
                    printerStatus.querySelector('.status-text').textContent = 'üñ®Ô∏è Imprimante Hors Ligne';
                } else {
                    printerStatus.className = 'kiosk-status active';
                    printerStatus.querySelector('.status-text').textContent = 'üñ®Ô∏è Imprimante Pr√™te';
                }
            }

            // M√©thodes manquantes pour la navigation
            cancelCapture() {
                this.stopCamera();
                this.isCapturing = false;
                document.getElementById('capture-interface').classList.add('hidden');
                document.getElementById('main-interface').classList.remove('hidden');
            }

            retakePhoto() {
                this.startCapture();
            }

            newPhoto() {
                document.getElementById('result-interface').classList.add('hidden');
                document.getElementById('main-interface').classList.remove('hidden');
                this.currentPhoto = null;
            }

            downloadPhoto() {
                if (!this.currentPhoto) return;

                const link = document.createElement('a');
                link.download = `photo-studio-${Date.now()}.jpg`;
                link.href = this.currentPhoto;
                link.click();

                PhotoboothConfig.stats.downloads++;
                this.updateStats();
                this.updatePhotoCounter();
            }
        }

        // Initialisation de l'application au chargement de la page
        let photoboothApp;

        document.addEventListener('DOMContentLoaded', () => {
            console.log('üéØ DOM charg√© - Initialisation de Photo Studio Pro...');
            photoboothApp = new PhotoboothApp();

            // Mise √† jour p√©riodique des statuts syst√®me
            setInterval(() => {
                photoboothApp.updateSystemStatus();
            }, 10000);

            // Gestion des erreurs globales
            window.addEventListener('error', (e) => {
                console.error('‚ùå Erreur globale:', e.error);
                photoboothApp.showError('Une erreur est survenue');
            });

            // Gestion des touches de raccourci
            document.addEventListener('keydown', (e) => {
                switch (e.key) {
                    case ' ': // Espace pour commencer
                        e.preventDefault();
                        if (!photoboothApp.isCapturing) {
                            photoboothApp.startCapture();
                        }
                        break;
                    case 'Escape': // √âchap pour annuler
                        if (photoboothApp.isCapturing) {
                            photoboothApp.cancelCapture();
                        }
                        break;
                    case 'Enter': // Entr√©e pour nouvelle photo
                        if (photoboothApp.currentPhoto) {
                            photoboothApp.newPhoto();
                        }
                        break;
                }
            });

            console.log('‚úÖ Photo Studio Pro initialis√© avec succ√®s !');
        });

        // Nettoyage lors de la fermeture
        window.addEventListener('beforeunload', () => {
            if (photoboothApp) {
                photoboothApp.stopCamera();
                if (photoboothApp.particlesInterval) {
                    clearInterval(photoboothApp.particlesInterval);
                }
            }
        });

        // Support des appareils mobiles
        if ('ontouchstart' in window) {
            document.body.classList.add('touch-device');
        }

        // Gestion de l'orientation pour les appareils mobiles
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                location.reload();
            }, 500);
        });
    </script>
</body>

</html>